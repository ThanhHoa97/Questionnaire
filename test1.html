<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participant Experiment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #video-container, #experiment-section {
            display: none;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        video {
            display: block;
            margin-top: 20px;
            width: 640px;
            height: 360px;
        }
    </style>
</head>
<body>
    <h1>Welcome to the Experiment</h1>
    <div id="input-section">
        <p>Please enter your Participant ID to begin:</p>
        <input type="number" id="participant-id-input" placeholder="Enter Participant ID">
        <button id="start-button">Start</button>
    </div>

    <div id="experiment-section">
        <div id="scenario-order"></div>
        <div id="video-container">
            <video id="current-video" controls>
                Your browser does not support the video tag.
            </video>
            <button id="next-video-button">Next Video</button>
        </div>
    </div>

    <script>
        // CSV file URL (replace with your GitHub file URL)
        const csvUrl = "https://raw.githubusercontent.com/ThanhHoa97/Questionnaire/main/latinsquare.csv";

        // Videos for each scenario
        const videos = {
            "Scenario 1": ["video1-1.mp4", "video1-2.mp4", "video1-3.mp4", "video1-4.mp4", "video1-5.mp4", "video1-6.mp4"],
            "Scenario 2": ["video2-1.mp4", "video2-2.mp4", "video2-3.mp4", "video2-4.mp4", "video2-5.mp4", "video2-6.mp4"],
            "Scenario 3": ["video3-1.mp4", "video3-2.mp4", "video3-3.mp4", "video3-4.mp4", "video3-5.mp4", "video3-6.mp4"],
            "Scenario 4": ["video4-1.mp4", "video4-2.mp4", "video4-3.mp4", "video4-4.mp4", "video4-5.mp4", "video4-6.mp4"],
            "Scenario 5": ["video5-1.mp4", "video5-2.mp4", "video5-3.mp4", "video5-4.mp4", "video5-5.mp4", "video5-6.mp4"]
        };

        // Fetch and parse the CSV file
        async function fetchCSV(url) {
            const response = await fetch(url);
            const data = await response.text();
            const rows = data.trim().split("\n");
            const parsed = rows.map(row => {
                const [id, order] = row.split(",");
                return {
                    id: parseInt(id, 10),
                    order: order.replace(/"/g, "").split(",")
                };
            });
            return parsed;
        }

        // Start the experiment for a given participant ID
        async function startExperiment(participantID) {
            // Fetch and parse the CSV file
            const data = await fetchCSV(csvUrl);

            // Find the participant's scenario order
            const participant = data.find(entry => entry.id === participantID);

            const scenarioOrderDiv = document.getElementById("scenario-order");
            const inputSection = document.getElementById("input-section");
            const experimentSection = document.getElementById("experiment-section");
            const videoContainer = document.getElementById("video-container");

            if (!participant) {
                alert("Invalid Participant ID. Please try again.");
                return;
            }

            // Hide the input section and show the experiment section
            inputSection.style.display = "none";
            experimentSection.style.display = "block";
            videoContainer.style.display = "block";

            // Participant's scenario order
            const scenarioOrder = participant.order;

            // Variables to track progress
            let currentScenarioIndex = 0;
            let currentVideoIndex = 0;

            const videoElement = document.getElementById("current-video");
            const nextVideoButton = document.getElementById("next-video-button");

            // Function to update the video
            const updateVideo = () => {
                const currentScenario = scenarioOrder[currentScenarioIndex];
                const currentVideos = videos[currentScenario];
                videoElement.src = currentVideos[currentVideoIndex];

                scenarioOrderDiv.innerHTML = `
                    <h2>Participant ID: ${participantID}</h2>
                    <h3>Current Scenario: ${currentScenario}</h3>
                    <p>Video ${currentVideoIndex + 1} of ${currentVideos.length}</p>
                `;
            };

            // Event listener for the "Next Video" button
            nextVideoButton.addEventListener("click", () => {
                const currentScenario = scenarioOrder[currentScenarioIndex];
                const currentVideos = videos[currentScenario];

                if (currentVideoIndex < currentVideos.length - 1) {
                    // Move to the next video
                    currentVideoIndex++;
                    updateVideo();
                } else if (currentScenarioIndex < scenarioOrder.length - 1) {
                    // Move to the next scenario
                    currentScenarioIndex++;
                    currentVideoIndex = 0;
                    updateVideo();
                } else {
                    // End of the experiment
                    scenarioOrderDiv.innerHTML = `
                        <h2>Thank You!</h2>
                        <p>You have completed all scenarios and videos.</p>
                    `;
                    videoElement.style.display = "none";
                    nextVideoButton.style.display = "none";
                }
            });

            // Initialize the first video
            updateVideo();
        }

        // Event listener for the "Start" button
        document.getElementById("start-button").addEventListener("click", () => {
            const participantIDInput = document.getElementById("participant-id-input").value;
            const participantID = parseInt(participantIDInput, 10);

            if (!participantID || participantID < 1) {
                alert("Please enter a valid Participant ID.");
                return;
            }

            startExperiment(participantID);
        });
    </script>
</body>
</html>
