<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Questionnaire</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .hidden {
            display: none;
        }
        .video, .questionnaire, .navigation {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
        }
        video {
            width: 1000px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <h1>Video Questionnaire</h1>
    <button id="begin-button">Begin</button>
    <div id="scenario-container" class="hidden"></div>
    <div id="next-scenario-container" class="hidden">
        <button id="next-scenario-button">Next Scenario</button>
    </div>
    <div id="completion-message" class="hidden">
        <h2>Thank you for completing the questionnaire!</h2>
    </div>

    <script>
        // Data structure for scenarios and videos
        const scenarios = [
            { id: 1, videos: ['videos/scenario1/Baseline.mp4', 'videos/scenario2/Point.mp4', 'videos/scenario1/Light.mp4'] },
            { id: 2, videos: ['videos/scenario1/Baseline.mp4', 'videos/scenario1/Baseline.mp4', 'videos/scenario1/Baseline.mp4'] },
            { id: 3, videos: ['videos/scenario1/Light.mp4', 'videos/scenario1/Baseline.mp4', 'videos/scenario1/Baseline.mp4'] },
            { id: 4, videos: ['videos/scenario1/Light.mp4', 'videos/scenario1/Baseline.mp4', 'videos/scenario1/Light.mp4'] },
        ];

        const questions = [
            "How engaging was the video?",
            "How clear was the content?",
            "How likely are you to recommend this video?"
        ];

        const questionnaireTemplate = `
            <!-- Trust -->
            <p>Please rate the following statements on a scale from 1 to 5 (strongly disagree to strongly agree)</p>
            <label for="q1">1. I trust the system</label>
            <input type="number" id="q1" name="q1" min="1" max="5" required><br><br>
            <label for="q2">2. I can rely on the system</label>
            <input type="number" id="q2" name="q2" min="1" max="5" required><br><br>

            <!-- Understanding -->
            <label for="q3">3. The system state was always clear to me</label>
            <input type="number" id="q3" name="q3" min="1" max="5" required><br><br>
            <label for="q4">4. I was able to understand why things happened</label>
            <input type="number" id="q4" name="q4" min="1" max="5" required><br><br>
            <label for="q5">5. Itâ€™s difficult to identify what the system will do next</label>
            <input type="number" id="q5" name="q5" min="1" max="5" required><br><br>

            <!-- visibility of the visualization -->
            <label for="q6">6. The visualization was clearly visible</label>
            <input type="number" id="q6" name="q6" min="1" max="5" required><br><br>

            <!-- Perception -->
            <p>Please rate the following statements on a scale from 1 to 7 (strongly disagree to strongly agree )</p>
            <label for="q7">7. How easily can you detect the object</label>
            <input type="number" id="q7" name="q7" min="1" max="7" required><br><br>
            <label for="q8">8. How easil can you keep your sppatio-temporal awareness</label>
            <input type="number" id="q8" name="q8" min="1" max="7" required><br><br>

            <!-- Attention -->
            <label for="q9">9. How would you rate your level of focus during the task while using this visualization</label>
            <input type="number" id="q9" name="q9" min="1" max="7" required><br><br>
            <label for="q10">10. How much is your attention divided in the situation? Are you concentrating on any aspect of the situation (High) (ex: critical object and situation) or focused on only one (low) (only critical object)</label>
            <input type="number" id="q10" name="q10" min="1" max="7" required><br><br>

            <!-- The complexity of the situation -->
            <label for="q11">11. How complicated is thesituation? Is it complex with many interrelated components (High) or it issimple and straightforward?</label>
            <input type="number" id="q11" name="q11" min="1" max="7" required><br><br>

            <!-- Usability -->
            <label for="q12">12. I think that I would like to use these visualizations frequently</label>
            <input type="number" id="q12" name="q12" min="1" max="7" required><br><br>
            <label for="q13">13.  I found the visualizations unnecessarily complex</label>
            <input type="number" id="q13" name="q13" min="1" max="7" required><br><br>
        
            <!-- Perceived safety -->
            <div class="question">
                <label for="q14">14. Please rate your perceived safety:</label>
                <div class="likert-options">
                    <label><input type="radio" name="q14" value="-3"> -3<br>anxious / agitated / unsafe / timid</label>
                    <label><input type="radio" name="q14" value="-2"> -2</label>
                    <label><input type="radio" name="q14" value="-1"> -1</label>
                    <label><input type="radio" name="q14" value="0"> 0</label>
                    <label><input type="radio" name="q14" value="1"> 1</label>
                    <label><input type="radio" name="q14" value="2"> 2</label>
                    <label><input type="radio" name="q14" value="3"> 3<br>relaxed / calm / safe / confident</label>
                </div>
            </div>

            <!-- Cognitive load -->
            <p>Please rate the following statements on a scale from 1 to 9 </p>
            <div class="question">
                <label for="q15">15. Please rate your mental effort to completed this task.</label>
                <div class="likert-options">
                    <label class="option">
                        <input type="radio" name="q15" value="1" required> 1 - very, very low
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="2"> 2 - very low
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="3"> 3 - low
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="4"> 4 - rather low
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="5"> 5 - neither low nor high
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="6"> 6 - rather high
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="7"> 7 - high
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="8"> 8 - very high
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="9"> 9 - very, very high
                    </label>
                </div>
            </div>
            <br><br>
            <button type="submit">Submit Questionnaire</button>
        `;

        let currentScenarioIndex = 0;
        let currentVideoIndex = 0;
        let currentQuestionnaireIndex = 0;

        const scenarioContainer = document.getElementById('scenario-container');
        const nextScenarioContainer = document.getElementById('next-scenario-container');
        const completionMessage = document.getElementById('completion-message');
        const beginButton = document.getElementById('begin-button');
        const nextScenarioButton = document.getElementById('next-scenario-button');

        let participantData = [];
        
        const videos = scenarios[currentScenarioIndex].videos;
        console.log("current scenario index 1 : ", currentScenarioIndex);
        const videoOrder = shuffleVideos(videos);
        console.log("video order : ", videoOrder);
        console.log("video lenght: ", videos.length);

        // Shuffle videos using Latin square randomization
        function shuffleVideos(videos) {
            return videos.sort(() => Math.random() - 0.5);
        }
        // Function to show the next video
        function showNextVideo() {
            
            console.log("current video index : ", currentVideoIndex);
            if (currentVideoIndex < videos.length) {
                const videoElement = document.createElement('video');
                //videoElement.src = videos[currentVideoIndex];
                videoElement.src = videoOrder[currentVideoIndex];
                videoElement.controls = true;
                videoElement.classList.add('video');

                videoElement.addEventListener('ended', () => {
                    currentVideoIndex++;
                    console.log("current video index 2: ", currentVideoIndex);
                    showNextVideo();
                });

                scenarioContainer.appendChild(videoElement);
                //currentVideoIndex++;
                console.log("current video index 3: ", currentVideoIndex);
            } else {
                // Show first questionnaire after videos are watched
                showQuestionnaire();
            }
        }

        // Function to show the next questionnaire
        function showQuestionnaire() {
            if (currentQuestionnaireIndex < 3) {
                const questionnaire = document.createElement('div');
                questionnaire.classList.add('questionnaire');

                const form = document.createElement('form');
                form.innerHTML = `
                    <h3>Questionnaire ${currentQuestionnaireIndex + 1}</h3>
                    <form id="questionnaire-form">
                        ${questionnaireTemplate}
                    </form>
                `;

                form.addEventListener('submit', (e) => {
                    e.preventDefault();

                    const formData = new FormData(form);
                    const answers = {};
                    for (let [key, value] of formData.entries()) {
                        answers[key] = value;
                    }

                    participantData.push({
                        scenario: scenarios[currentScenarioIndex].id,
                        questionnaire: currentQuestionnaireIndex + 1,
                        responses: answers
                    });

                    currentQuestionnaireIndex++;
                    showQuestionnaire();
                });

                questionnaire.appendChild(form);
                scenarioContainer.appendChild(questionnaire);
                //currentQuestionnaireIndex++;
            } else {
                nextScenarioContainer.classList.remove('hidden');
            }
        }

        // Function to start the next scenario
        function startNextScenario() {
            scenarioContainer.innerHTML = '';
            nextScenarioContainer.classList.add('hidden');
            currentVideoIndex = 0;
            currentQuestionnaireIndex = 0;

            currentScenarioIndex++;
            if (currentScenarioIndex < scenarios.length) {
                console.log("current scenario index 2 : ", currentScenarioIndex);
                showNextVideo();
            } else {
                completionMessage.classList.remove('hidden');
            }
        }

        // Event listeners
        beginButton.addEventListener('click', () => {
            beginButton.classList.add('hidden');
            scenarioContainer.classList.remove('hidden');
            showNextVideo();
        });

        nextScenarioButton.addEventListener('click', startNextScenario);
    </script>
</body>
</html>